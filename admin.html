<!DOCTYPE html>
<html>
<body>
<h3>Generate QR Absensi</h3>
<button onclick="generate()">Generate QR</button>
<div id="qr" style="margin-top:20px;"></div>
<p id="tokenText"></p>

<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
// function generate() {
// //   fetch("https://script.google.com/macros/s/AKfycbym0TUkwd-tOcwxRkwbiebefQBk86uwQfaSmoj6wmX8-to-J4Nwb7xT-BzIvrdYP5FJ/exec")
// //     .then(res => res.text())
// //     .then(token => {
// //       const url = location.origin + "/?token=" + token;
// //       document.getElementById("qr").innerHTML = "";
// //       new QRCode(document.getElementById("qr"), url);
// //     });
    
//     const API_URL = "https://script.google.com/macros/s/AKfycbym0TUkwd-tOcwxRkwbiebefQBk86uwQfaSmoj6wmX8-to-J4Nwb7xT-BzIvrdYP5FJ/exec";
//     fetch(API_URL, {
//       method: "POST",
//       body: new URLSearchParams({
//         action: "GENERATE_TOKEN"
//       })
//     })
//     .then(res => res.json())
//     .then(data => {
//       alert("Token: " + data.token);
//     })
//     .catch(e => console.error(e));
// }

function generate() {
  fetch("https://absensi-backend.martinusdx001.workers.dev/", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "GENERATE_TOKEN"
    })
  })
  .then(res => res.json())
  .then(data => {
    alert("Token: " + data.token)

    document.getElementById("tokenText").innerText =
      "Token: " + data.token;

    const qrContainer = document.getElementById("qr");
    qrContainer.innerHTML = ""; // clear QR lama

    const qrData = JSON.stringify({
      token: data.token,
      date: new Date().toISOString().slice(0, 10)
    });

    new QRCode(qrContainer, {
      text: qrData,
      width: 256,
      height: 256
    });
  });
}
</script>
</body>
</html>
